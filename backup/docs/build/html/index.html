<!DOCTYPE html>
<html lang="en-gb">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Integration Options</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha256-NuCn4IvuZXdBaFKJOAcsU2Q3ZpwbdFisd5dux4jkQ5w=" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.css" integrity="sha256-xOpS+e/dER8z72w+qryCieOGysQI8cELAVt3MHG0phY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/css/tooltipster.bundle.min.css" integrity="sha256-Qc4lCfqZWYaHF5hgEOFrYzSIX9Rrxk0NPHRac+08QeQ=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-light.min.css" integrity="sha256-Wa1I4jhSXeWd3N6RhfPlkqr1WlT+zS3Vh2YGCg0129E=" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Code+Pro|Source+Sans+Pro|Source+Serif+Pro|Roboto|Roboto+Mono" rel="stylesheet">
<link href="https://fonts.red-dove.com/iosevka-ss09-regular/webfont.css" rel="stylesheet">

    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/sizzle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/sizzle.css" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" integrity="sha256-G7A4JrJjJlFqP0yamznwPjAApIKPkadeHfyIwiaa9e0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/js/tooltipster.bundle.min.js" integrity="sha256-NOU7KrY2aTI4PxDegqYUIknk9qfxVCS0E4JfE9aMwaA=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
      $(document).data('sizzle', {on_load: []});
    </script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/js/expand_tabs.js"></script>
      <script src="app-data.js"></script>
<link rel="index" title="Index" href="genindex.html" />
<link rel="search" title="Search" href="search.html" />

</head>
<body class="full-height test">
<noscript>
  <div>
    <div id="noscript-message">JavaScript is not enabled. It is needed for this website to work.</div>
  </div>
</noscript>
<div id="whole-page" class="container-fluid content full-height">
  <div id="header-row" class="row">
    <div id="header-container" class="col-md-12">
      <div id="hdr-left">
        <i class="fa fa-bars menu-toggle"></i>
        
<span class="text-logo">Bankograph  documentation</span>

      </div>
      <div id="hdr-centre" class="text-center stretch">
        <h3 title="Integration Options">Integration Options</h3>
        <h6>Integration Options</h6>
      </div>
      <div id="hdr-search">
        
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
      </div>

      <div id="hdr-index">
        <a href="genindex.html" class="btn btn-default" title="Go to the index"><i class="fa fa-list"></i></a>
      </div>

      <div id="hdr-source">
        <a href="_sources/index.rst.txt" class="btn btn-default" title="See the source for this page"><i class="fa fa-code"></i></a>
      </div>

      <div id="hdr-right">
        
  
      </div>
      <div id="alt-hdr-right">



        <a href="search.html"><i class="fa fa-search mr-8"></i></a>


        <a href="genindex.html"><i class="fa fa-list mr-8"></i></a>


      </div>
    </div>
  </div>

  <div id="content-row" class="row">
    <div id="page-content" class="col-md-12 flex-col">
      <div id="content-container">
        <div id="nav">
          
  <div class="navsidebar">
    <div id="sidebar-search">
      
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
    </div>
      <div class="sidebar-block">
        <div class="sidebar-tocheading">
          <div class="pull-left">
            <h2>Table Of Contents</h2>
          </div>
          <div class="pull-right" title="Hide this sidebar (hover at left edge to bring it back)"><i class="fa fa-chevron-left hidetoc"></i></div>
        </div>
        <div class="sidebar-toc">
      
          <div id="toc-filter" title="Type in here to show only matching topics">
            <input class="form-control" id="toc-filter-query" placeholder="Filter by title ...">
          </div>
      
        
  
  <div class="localtoc">
    <ul>
<li><a class="lvl-1 reference internal" href="#integration-options">Integration Options</a><ul>
<li><a class="lvl-2 reference internal" href="#payment-page">Payment Page</a></li>
<li><a class="lvl-2 reference internal" href="#rest-api">REST API</a></li>
<li><a class="lvl-2 reference internal" href="#batch-processing-api">Batch Processing API</a></li>
<li><a class="lvl-2 reference internal" href="#sdk">SDK</a></li>
</ul>
</li>
<li><a class="lvl-1 reference internal" href="#integration-guides">Integration Guides</a><ul>
<li><a class="lvl-2 reference internal" href="#bankograph-payment-page-v2">Bankograph Payment Page v2</a><ul>
<li><a class="lvl-3 reference internal" href="#hpp-integration-guide">HPP Integration Guide</a><ul>
<li><a class="lvl-4 reference internal" href="#overview">Overview</a></li>
<li><a class="lvl-4 reference internal" href="#payment-processing-example">Payment-Processing Example</a></li>
<li><a class="lvl-4 reference internal" href="#merchants-integrated-with-nvp-hpp">Merchants Integrated with NVP (HPP)</a></li>
</ul>
</li>
<li><a class="lvl-3 reference internal" href="#epp-integration-guide">EPP Integration Guide</a><ul>
<li><a class="lvl-4 reference internal" href="#id3">Overview</a></li>
<li><a class="lvl-4 reference internal" href="#id4">Payment-Processing Example</a></li>
<li><a class="lvl-4 reference internal" href="#merchants-integrated-with-nvp-epp">Merchants Integrated with NVP (EPP)</a></li>
</ul>
</li>
<li><a class="lvl-3 reference internal" href="#seamless-integration-guide">Seamless Integration Guide</a><ul>
<li><a class="lvl-4 reference internal" href="#id7">Overview</a></li>
<li><a class="lvl-4 reference internal" href="#first-steps">First Steps</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  
        </div>
      </div>
  </div>
        </div>
        <div id="content" tabindex="0" class="stretch">
          <div id="mnav">
            
  
  <div class="localtoc">
    <ul>
<li><a class="lvl-1 reference internal" href="#integration-options">Integration Options</a><ul>
<li><a class="lvl-2 reference internal" href="#payment-page">Payment Page</a></li>
<li><a class="lvl-2 reference internal" href="#rest-api">REST API</a></li>
<li><a class="lvl-2 reference internal" href="#batch-processing-api">Batch Processing API</a></li>
<li><a class="lvl-2 reference internal" href="#sdk">SDK</a></li>
</ul>
</li>
<li><a class="lvl-1 reference internal" href="#integration-guides">Integration Guides</a><ul>
<li><a class="lvl-2 reference internal" href="#bankograph-payment-page-v2">Bankograph Payment Page v2</a><ul>
<li><a class="lvl-3 reference internal" href="#hpp-integration-guide">HPP Integration Guide</a><ul>
<li><a class="lvl-4 reference internal" href="#overview">Overview</a></li>
<li><a class="lvl-4 reference internal" href="#payment-processing-example">Payment-Processing Example</a></li>
<li><a class="lvl-4 reference internal" href="#merchants-integrated-with-nvp-hpp">Merchants Integrated with NVP (HPP)</a></li>
</ul>
</li>
<li><a class="lvl-3 reference internal" href="#epp-integration-guide">EPP Integration Guide</a><ul>
<li><a class="lvl-4 reference internal" href="#id3">Overview</a></li>
<li><a class="lvl-4 reference internal" href="#id4">Payment-Processing Example</a></li>
<li><a class="lvl-4 reference internal" href="#merchants-integrated-with-nvp-epp">Merchants Integrated with NVP (EPP)</a></li>
</ul>
</li>
<li><a class="lvl-3 reference internal" href="#seamless-integration-guide">Seamless Integration Guide</a><ul>
<li><a class="lvl-4 reference internal" href="#id7">Overview</a></li>
<li><a class="lvl-4 reference internal" href="#first-steps">First Steps</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  
          </div>
          <div class="body">
            
  <div class="section" id="integration-options">
<h1>Integration Options<a class="headerlink" href="#integration-options" title="Permalink to this headline">¶</a></h1>
<p>There are multiple integration options available for Bankograph Payment Gateway.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<ul class="last simple">
<li>The integration via <strong>Payment Page</strong> is described under <a class="reference internal" href="#payment-page">Payment Page</a>.</li>
<li>For (near) real-time processing the backend implementation is described under <a class="reference internal" href="#rest-api">REST API</a>.
However, the description of payment methods, for example, is common for both Payment Page and         REST API.</li>
<li>Processing of multiple transactions using batches is described under Batch Processing API, available for both SEPA Direct Debit and SEPA Credit Transfer.</li>
<li>Our Payment SDK offers a seamless user experience by rendering a payment form as an integral part of the merchant’s mobile application.</li>
</ul>
</div>
<div class="section" id="payment-page">
<h2>Payment Page<a class="headerlink" href="#payment-page" title="Permalink to this headline">¶</a></h2>
<p>Bankograph Payment Page stands for secure, flexible, easy and transparent payment processing.</p>
<p>It provides all payment methods and related options in one solution: Credit Card (with/without 3D secure), SEPA, online banking payments, mobile payments, alternative payment methods, and industry-specific solutions.</p>
<p>It handles the payment method selection as well as the collection of payment details or consumer redirects to alternative payment provider sites. With this solution, the merchant is only required to conform to a limited PCI scope (self-questionnaire A).</p>
<p>Bankograph Payment Page is available in three formats:</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<ul class="last simple">
<li>Hosted Payment Page (HPP): The consumer is redirected to Bankograph Payment Gateway to finish the checkout process.</li>
<li>Embedded Payment Page (EPP): The payment screen is displayed in overlay directly on the merchant’s checkout page.</li>
<li>Seamless integration: The merchant’s checkout page is incorporated into Bankograph’s payment form. This solution provides a seamless shopping experience for web-shoppers.</li>
</ul>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Only HTML knowledge is required for Bankograph Payment Page integration.</p>
</div>
</div>
<div class="section" id="rest-api">
<h2>REST API<a class="headerlink" href="#rest-api" title="Permalink to this headline">¶</a></h2>
<p>When merchants want full control over the checkout and payment process they can create requests themselves and send them directly to the REST API. All communications between a merchant and the REST API are secured by TLS encryption (HTTPS).</p>
<p>Integration is possible by:</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<ul class="last simple">
<li>XML requests sent from merchant’s backend (server-to-server)</li>
<li>JSON respectively</li>
<li>NVP (for credit card only)</li>
</ul>
</div>
<p>PCI certified merchants can use Bankograph Payment Gateway without any restrictions.</p>
<p>Non PCI certified merchants can use Bankograph Payment Gateway only with referenced or recurring transactions. For initial transactions they must use a front end solution (e.g. HPP).</p>
<p>Details to integrate Bankograph Payment Gateway via REST API are described here.</p>
</div>
<div class="section" id="batch-processing-api">
<h2>Batch Processing API<a class="headerlink" href="#batch-processing-api" title="Permalink to this headline">¶</a></h2>
<p>In order to process multiple transactions at the same time, Bankograph’s Batch Processing is the ideal solution for both fast and easy to implement offline bulk transaction processing.</p>
<p>Batch processing is possible for the following payment methods:</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<ul class="last simple">
<li>SEPA Direct Debit</li>
<li>SEPA Credit Transfer</li>
<li>Credit Card</li>
</ul>
</div>
</div>
<div class="section" id="sdk">
<h2>SDK<a class="headerlink" href="#sdk" title="Permalink to this headline">¶</a></h2>
<p>The Software Development Kit (SDK) serves as a wrapper for the Bankograph Payment Gateway with a PCI V3 compliant native mobile payment form. SDK is naturally developed for the integration into a merchant’s app as a software library where it covers sending payment requests to the Bankograph Payment Gateway. It uses REST requests constructed by the merchant sent over HTTPS protocol to Bankograph Payment Gateway end-point where the REST API is exposed.</p>
<p>The following payment methods are currently supported:</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<ul class="last simple">
<li>Credit Card</li>
<li>PayPal</li>
<li>SEPA Direct Debit</li>
<li>Apple Pay</li>
<li>Google Pay™</li>
</ul>
</div>
<p>Operation system interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">iOS</span>

<span class="o">-</span> <span class="n">Android</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Working programmer knowledge is required to integrate this way.</p>
</div>
</div>
</div>
<div class="section" id="integration-guides">
<h1>Integration Guides<a class="headerlink" href="#integration-guides" title="Permalink to this headline">¶</a></h1>
<div class="section" id="bankograph-payment-page-v2">
<h2>Bankograph Payment Page v2<a class="headerlink" href="#bankograph-payment-page-v2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hpp-integration-guide">
<h3>HPP Integration Guide<a class="headerlink" href="#hpp-integration-guide" title="Permalink to this headline">¶</a></h3>
<div class="section" id="overview">
<h4>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>To integrate the Hosted Payment Page (HPP) in your shop, use a simple backend-to-backend JSON WPP v2 Workflow for the payment process.</p>
<ol class="arabic simple">
<li><strong>Create a payment session:</strong> You send an initial POST request with details of the transaction to the Bankograph Payment Page v2 (WPP v2). This POST request is secured by basic access authentication.</li>
<li><strong>Redirect the consumer to the payment page:</strong> WPP v2 returns an initial response URL.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="o">*</span> <span class="n">If</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">POST</span> <span class="n">request</span> <span class="ow">is</span> <span class="n">correct</span> <span class="o">*</span><span class="p">,</span> <span class="n">use</span> <span class="n">the</span> <span class="n">response</span> <span class="n">URL</span> <span class="n">to</span> <span class="n">redirect</span> <span class="n">the</span> <span class="n">consumer</span> <span class="n">to</span> <span class="n">the</span> <span class="n">payment</span> <span class="n">page</span><span class="o">.</span> <span class="n">The</span> <span class="n">consumer</span> <span class="n">fills</span> <span class="n">out</span> <span class="n">the</span> <span class="n">required</span> <span class="n">fields</span> <span class="n">on</span> <span class="n">the</span> <span class="n">payment</span> <span class="n">page</span> <span class="ow">and</span> <span class="n">submits</span> <span class="n">the</span> <span class="n">payment</span><span class="o">.</span> <span class="n">Continue</span> <span class="k">with</span> <span class="n">step</span> <span class="mf">3.</span>

<span class="o">-</span> <span class="o">*</span> <span class="n">If</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">POST</span> <span class="n">request</span> <span class="ow">is</span> <span class="n">faulty</span> <span class="o">*</span><span class="p">,</span> <span class="n">WPP</span> <span class="n">v2</span> <span class="n">returns</span> <span class="n">an</span> <span class="n">error</span> <span class="n">code</span> <span class="k">with</span> <span class="n">a</span> <span class="n">description</span> <span class="n">of</span> <span class="n">the</span> <span class="n">problem</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">response</span><span class="o">.</span> <span class="o">**</span><span class="n">Return</span> <span class="n">to</span> <span class="n">step</span> <span class="mi">1</span><span class="o">**.</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><strong>Parse and process the payment response:</strong> The payment is processed. Depending on the result (successful, pending, failed or canceled), the consumer is redirected to the respective page. The WPP v2 sends a POST request containing base64 encoded payment data to the same URL. It is highly recommended that you parse and process this base64 encoded response to verify the payment.</li>
</ol>
<p><strong>The payment process is complete.</strong></p>
</div>
<div class="section" id="payment-processing-example">
<h4>Payment-Processing Example<a class="headerlink" href="#payment-processing-example" title="Permalink to this headline">¶</a></h4>
<p>This is an example of a credit card transaction to show how to process a payment with the Hosted Payment Page.</p>
<p>For more supported payment methods and payment-method-specific integration guides, go to <a href="#id16"><span class="problematic" id="id17">`Payment Methods with WPP v2`_</span></a>.</p>
<p>The payment-processing example is designed for the testing environment and does not use real information.</p>
<p><strong>Payment processing with the Bankograph Payment Page v2 generally follows the same steps:</strong></p>
<ol class="arabic simple">
<li>Create a payment session (initial request).</li>
<li>Redirect the consumer to the payment page (initial response URL).</li>
<li>Highly recommended: Parse and process the payment response.</li>
</ol>
<p>We provide ready-made JSON samples for each step of this process. Use a tool such as Postman to test them.</p>
<p><strong>Setup and Test Credentials</strong></p>
<p>Before you can send your first request, use the following information to set up your testing tool:</p>
<table id="id8">
<caption><span class="caption-text">Test Credentials</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>URL (Endpoint)</strong></td>
<td>{rest-api-test-endpoint}</td>
</tr>
<tr class="row-even"><td><strong>Merchant Account ID (MAID)</strong></td>
<td>7a6dd74f-06ab-4f3f-a864-adc52687270a</td>
</tr>
<tr class="row-odd"><td><strong>Username</strong></td>
<td>70000-APIDEMO-CARD</td>
</tr>
<tr class="row-even"><td><strong>Password</strong></td>
<td>ohysS0-dvfMx</td>
</tr>
<tr class="row-odd"><td><strong>Secret Key (used for response verification)</strong></td>
<td>a8c3fce6-8df7-4fd6-a1fd-62fa229c5e55</td>
</tr>
<tr class="row-even"><td><strong>Test Card</strong></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><strong>Card number</strong></td>
<td>4200000000000018</td>
</tr>
<tr class="row-even"><td><strong>Expiration date</strong></td>
<td>01/23</td>
</tr>
<tr class="row-odd"><td><strong>CVV</strong></td>
<td>018</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li><strong>Create a Payment Session</strong></li>
</ol>
<p>To create a payment session, send a POST request to the /api/payment/register endpoint, e.g. <a class="reference external" href="https://wpp-test.bankograph.com/api/payment/register">https://wpp-test.bankograph.com/api/payment/register</a>.</p>
<p>This is an HTTP request with two headers:</p>
<blockquote>
<div><strong>Request Headers</strong></div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="n">Authorization</span><span class="p">:</span> <span class="n">Basic</span> <span class="n">NzAwMDAtQVBJREVNTy1DQVJEOm9oeXNTMC1kdmZNeA</span><span class="o">==</span>
</pre></div>
</div>
<p>The Authorization header needs to be formatted as: &quot;Authorization&quot;=&quot;Basic&quot; + base64(&quot;username:password&quot;)</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Code Blocks can have captions.</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span> <span class="p">{</span>
   <span class="nt">&quot;payment&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="nt">&quot;merchant-account-id&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;7a6dd74f-06ab-4f3f-a864-adc52687270a&quot;</span>
<span class="p">},</span>
<span class="nt">&quot;request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;{{$guid}}&quot;</span><span class="p">,</span>
<span class="nt">&quot;transaction-type&quot;</span><span class="p">:</span> <span class="s2">&quot;authorization&quot;</span><span class="p">,</span>
<span class="nt">&quot;requested-amount&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nt">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;EUR&quot;</span>
<span class="p">},</span>
<span class="nt">&quot;account-holder&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;first-name&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
  <span class="nt">&quot;last-name&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span>
<span class="p">},</span>
<span class="nt">&quot;payment-methods&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;payment-method&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;creditcard&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">},</span>
<span class="nt">&quot;success-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/success&quot;</span><span class="p">,</span>
<span class="nt">&quot;fail-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/error&quot;</span><span class="p">,</span>
<span class="nt">&quot;cancel-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/cancel&quot;</span>
<span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<table id="id10">
<caption><span class="caption-text">Field Table</span><a class="headerlink" href="#id10" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-even"><td><strong>Field (JSON)</strong></td>
<td><strong>Data Type</strong></td>
<td><strong>Required/Optional</strong></td>
<td><strong>Size</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-odd"><td>merchant-account-id / value</td>
<td>String</td>
<td>Required</td>
<td>36</td>
<td>A unique identifier assigned to every merchant account (by Bankograph).</td>
</tr>
<tr class="row-even"><td>request-id</td>
<td>String</td>
<td>Required</td>
<td>150</td>
<td><dl class="first last docutils">
<dt>A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later. {{$guid}} serves as a placeholder for a random request-id. Allowed characters:</dt><dd>a - z
0 - 9</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td>transaction-type</td>
<td>String</td>
<td>Required</td>
<td>36</td>
<td>The requested transaction type.</td>
</tr>
<tr class="row-even"><td>requested-amount /Value</td>
<td>Numeric</td>
<td>Required</td>
<td>18</td>
<td>The full amount that is requested/contested in a transaction. 2 decimal places allowed. Use (decimal point) as the separator.</td>
</tr>
<tr class="row-odd"><td>requested-amount /currency</td>
<td>String</td>
<td>Required</td>
<td>3</td>
<td>The currency of the requested/contested transaction amount. Format 3-character abbreviation according to ISO 4217.</td>
</tr>
<tr class="row-even"><td>account holder / first-name</td>
<td>String</td>
<td>Optional</td>
<td>32</td>
<td>The first name of the account holder.</td>
</tr>
<tr class="row-odd"><td>account holder / last-name</td>
<td>String</td>
<td>Required</td>
<td>32</td>
<td>The last name of the account holder.</td>
</tr>
<tr class="row-even"><td>payment-method / name</td>
<td>String</td>
<td>Optional</td>
<td>15</td>
<td>The name of the payment method used. Set this value to creditcard.</td>
</tr>
<tr class="row-odd"><td>success-redirect-url</td>
<td>String</td>
<td>Optional</td>
<td>256</td>
<td>The URL to which the consumer is redirected after a successful payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/success">https://demoshop-test.bankograph.com/demoshop/#/success</a></td>
</tr>
<tr class="row-even"><td>fail-redirect-url</td>
<td>String</td>
<td>Optional</td>
<td>256</td>
<td>The URL to which the consumer is redirected after a unsuccessful payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/error">https://demoshop-test.bankograph.com/demoshop/#/error</a></td>
</tr>
<tr class="row-odd"><td>cancel-redirect-url</td>
<td>String</td>
<td>Optional</td>
<td>256</td>
<td>The URL to which the consumer is redirected after having canceled a payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/cancel">https://demoshop-test.bankograph.com/demoshop/#/cancel</a></td>
</tr>
</tbody>
</table>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">To create a payment session with Credit Card using 3D Secure 2 authentication, you need to include 3D Secure 2 fields in your initial request.
Most of these fields are optional but we recommend the implementation of optional fields, as this creates a smoother user experience and ensures a higher level of security.
Need more information on 3D Secure 2? Head to our general introduction to 3D Secure 2.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p><strong>Which Payment Methods Can I Choose?</strong></p>
<p>Leave out the payment-methods object from the request. WPP v2 will show a grid of all available payment methods (based on your merchant configuration).</p>
<p class="last">Alternatively, check out Payment Methods with WPP v2 for an overview of all supported payment methods.</p>
</div>
<p><strong>Download the full integration demo from our GitHub</strong></p>
<a class="reference external image-reference" href="https://github.com/wirecard/wpp-integration-demo-java"><img alt="_images/Available_on_Github_JAVA.png" src="_images/Available_on_Github_JAVA.png" /></a>
<a class="reference external image-reference" href="https://github.com/wirecard/wpp-integration-demo-php"><img alt="_images/Available_on_Github_PHP.png" src="_images/Available_on_Github_PHP.png" /></a>
<ol class="arabic simple" start="2">
<li><strong>Redirect the Consumer to the Payment Page</strong></li>
</ol>
<p>The response to the initial authorization request contains the payment-redirect-url.</p>
<p><strong>Response to Authorization Request</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s2">&quot;payment-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://wpp-test.bankograph.com/?wPaymentToken=f0c0e5b3-23ad-4cb4-abca-ed80a0e770e7&quot;</span>
<span class="p">}</span>

<span class="n">Use</span> <span class="n">the</span> <span class="n">payment</span><span class="o">-</span><span class="n">redirect</span><span class="o">-</span><span class="n">url</span> <span class="n">to</span> <span class="n">redirect</span> <span class="n">the</span> <span class="n">consumer</span><span class="o">.</span>

<span class="n">You</span> <span class="n">can</span> <span class="n">implement</span> <span class="n">the</span> <span class="n">redirection</span> <span class="ow">in</span> <span class="nb">any</span> <span class="n">way</span> <span class="n">that</span> <span class="n">suits</span> <span class="n">you</span> <span class="n">best</span><span class="o">.</span>

<span class="o">**</span><span class="n">Redirecting</span> <span class="n">Consumers</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Payment</span> <span class="n">Page</span> <span class="n">Using</span><span class="o">**</span> <span class="n">WPP</span><span class="o">.</span><span class="n">hostedPayUrl</span>

<span class="n">You</span> <span class="n">can</span> <span class="n">use</span> <span class="n">our</span> <span class="n">ready</span><span class="o">-</span><span class="n">made</span> <span class="n">function</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">the</span> <span class="n">redirection</span><span class="p">:</span>

<span class="n">You</span> <span class="n">can</span> <span class="n">use</span> <span class="n">our</span> <span class="n">ready</span><span class="o">-</span><span class="n">made</span> <span class="n">function</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">the</span> <span class="n">redirection</span><span class="p">:</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>Add the paymentPage.js library to your checkout page HTML code</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;https://wpp-test.bankograph.com/loader/paymentPage.js&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Submit the initial payment request on the backend.</li>
</ol>
<p>3. Call the <code class="docutils literal notranslate"><span class="pre">WPP.hostedPayUrl(payment-redirect-url)</span></code> function in your HTML code to redirect the consumer to a new window:
.. code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">script</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>
 <span class="n">WPP</span><span class="o">.</span><span class="n">hostedPayUrl</span><span class="p">(</span><span class="s2">&quot;https://wpp-test.bankograph.com/?wPaymentToken=f0c0e5b3-23ad-4cb4-abca-ed80a0e770e7&quot;</span><span class="p">)</span>
 <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

<span class="n">Make</span> <span class="n">sure</span> <span class="n">to</span> <span class="k">pass</span> <span class="n">the</span> <span class="n">payment</span><span class="o">-</span><span class="n">redirect</span><span class="o">-</span><span class="n">url</span> <span class="n">value</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">initial</span> <span class="n">response</span> <span class="n">to</span> <span class="n">the</span> <span class="n">redirection</span> <span class="n">function</span> <span class="ow">and</span> <span class="n">call</span> <span class="n">it</span><span class="o">.</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p>The consumer is redirected to the payment form. There they enter their data and submit the form to confirm the payment. The response can</p>
<ul class="simple">
<li>be successful (<code class="docutils literal notranslate"><span class="pre">transaction-state:</span> <span class="pre">success</span></code>)</li>
<li>fail (<code class="docutils literal notranslate"><span class="pre">transaction-state:</span> <span class="pre">failed</span></code>)</li>
<li>or the consumer canceled the payment before/after submission (<code class="docutils literal notranslate"><span class="pre">transaction-state:</span> <span class="pre">failed</span></code>).</li>
</ul>
<p>The transaction result is displayed as the value of <code class="docutils literal notranslate"><span class="pre">transaction-state</span></code> in the payment response. Canceled payments are returned as <code class="docutils literal notranslate"><span class="pre">&quot;transaction-state&quot;</span> <span class="pre">:</span> <span class="pre">&quot;failed&quot;</span></code>, but the status description indicates it was canceled. More information (including the status code) can also be found in the payment response in the statuses object.</p>
<p>In any case, a base64 encoded response containing payment information is sent to the corresponding redirection URL <code class="docutils literal notranslate"><span class="pre">(success-redirect-url,</span> <span class="pre">cancel-redirect-url,</span> <span class="pre">or</span> <span class="pre">fail-redirect-url)</span></code>.</p>
<p class="last">See <a href="#id18"><span class="problematic" id="id19">`Configuring Redirects and IPNs for WPP v2`_</span></a> for more information on redirection targets after payment.</p>
</div>
<ol class="arabic simple" start="3">
<li><strong>Parse and Process the Payment Response (Highly Recommended)</strong></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">Where</span> <span class="pre">Can</span> <span class="pre">I</span> <span class="pre">Find</span> <span class="pre">the</span> <span class="pre">Payment</span> <span class="pre">Response?</span></code></p>
<p>WPP v2 sends the final response to the success/fail page where the consumer is redirected to at the end of the payment session. This final response contains the payment data in a base64 encoded JSON format. It is sent with a POST request as form data <code class="docutils literal notranslate"><span class="pre">response-base64</span></code>.</p>
<img alt="_images/Base64_v2_1.png" src="_images/Base64_v2_1.png" />
<p>Before you are able to parse and process the payment response, you need to decode it.</p>
<p><strong>To test this</strong></p>
<ul class="simple">
<li>Copy and paste the <code class="docutils literal notranslate"><span class="pre">payment-redirect-url</span></code> into your browser.</li>
<li>Open your browser’s console and complete the payment with the credit card information provided above.</li>
<li>In your browser’s console, find the form data <code class="docutils literal notranslate"><span class="pre">response-base64</span></code> (see screenshot).</li>
<li>Copy and paste the response into a base64 decoder of your choice, e.g. <a href="#id1"><span class="problematic" id="id2">:PEP:`Base64 Decode`</span></a>.</li>
<li>Decode the response to view the payment response details.</li>
</ul>
<p>You can find a decoded payment response example below.</p>
<p><strong>Parse and Process the Payment Response (Decoded Payment Response)</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s2">&quot;payment&quot;</span><span class="p">:</span> <span class="p">{</span>
   <span class="s2">&quot;transaction-type&quot;</span><span class="p">:</span> <span class="s2">&quot;authorization&quot;</span><span class="p">,</span>
   <span class="s2">&quot;transaction-id&quot;</span><span class="p">:</span> <span class="s2">&quot;08649015-eb17-4c67-ab5f-d132af616e02&quot;</span><span class="p">,</span>
   <span class="s2">&quot;completion-time-stamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-12-19T12:02:26&quot;</span><span class="p">,</span>
   <span class="s2">&quot;card-token&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">&quot;token-id&quot;</span><span class="p">:</span> <span class="s2">&quot;4242796444090018&quot;</span><span class="p">,</span>
     <span class="s2">&quot;masked-account-number&quot;</span><span class="p">:</span> <span class="s2">&quot;420000******0018&quot;</span>
   <span class="p">},</span>
   <span class="s2">&quot;merchant-account-id&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;7a6dd74f-06ab-4f3f-a864-adc52687270a&quot;</span>
   <span class="p">},</span>
   <span class="s2">&quot;transaction-state&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
   <span class="s2">&quot;payment-methods&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">&quot;payment-method&quot;</span><span class="p">:</span> <span class="p">[</span>
       <span class="p">{</span>
         <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;creditcard&quot;</span>
       <span class="p">}</span>
     <span class="p">]</span>
    <span class="p">},</span>
   <span class="s2">&quot;cancel-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/cancel&quot;</span><span class="p">,</span>
   <span class="s2">&quot;success-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/success&quot;</span><span class="p">,</span>
   <span class="s2">&quot;fail-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/error&quot;</span><span class="p">,</span>
   <span class="s2">&quot;api-id&quot;</span><span class="p">:</span> <span class="s2">&quot;wpp&quot;</span>
  <span class="p">},</span>
 <span class="s2">&quot;request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;28285dbd-ecd3-49bd-a7e5-0239affa2448&quot;</span><span class="p">,</span>
 <span class="s2">&quot;requested-amount&quot;</span><span class="p">:</span> <span class="p">{</span>
   <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
   <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">10</span>
  <span class="p">},</span>
 <span class="s2">&quot;statuses&quot;</span><span class="p">:</span> <span class="p">{</span>
   <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="p">[</span>
     <span class="p">{</span>
       <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;3d-acquirer:The resource was successfully created.&quot;</span><span class="p">,</span>
       <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;information&quot;</span><span class="p">,</span>
       <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;201.0000&quot;</span>
     <span class="p">}</span>
   <span class="p">]</span>
  <span class="p">},</span>
 <span class="s2">&quot;authorization-code&quot;</span><span class="p">:</span> <span class="s2">&quot;801433&quot;</span><span class="p">,</span>
 <span class="s2">&quot;account-holder&quot;</span><span class="p">:</span> <span class="p">{</span>
   <span class="s2">&quot;first-name&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
   <span class="s2">&quot;last-name&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span>
  <span class="p">},</span>
 <span class="s2">&quot;descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;demo descriptor&quot;</span>
 <span class="p">}</span>
</pre></div>
</div>
<table id="id11">
<caption><span class="caption-text">Field Table</span><a class="headerlink" href="#id11" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr class="row-even"><td><strong>Field (JSON)</strong></td>
<td><strong>Data Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-odd"><td>transaction-type</td>
<td>String</td>
<td>The requested transaction type.</td>
</tr>
<tr class="row-even"><td>transaction-id</td>
<td>String</td>
<td>A unique identifier to every transaction (by Bankograph). Used when searching for or referencing to it later.</td>
</tr>
<tr class="row-odd"><td>completion-time-stamp</td>
<td>YYYY-MM-DD-Thh:mm:ss</td>
<td>The UTC/ISO time-stamp documents the time &amp; date when the transaction was executed. Format: YYYY-MM-DDThh:mm:ss (ISO).</td>
</tr>
<tr class="row-even"><td>card token / token-id</td>
<td>String</td>
<td>A unique identifier assigned to every card token.</td>
</tr>
<tr class="row-odd"><td>card token / masked-account-number</td>
<td>String</td>
<td>This is the masked card account number of the consumer.</td>
</tr>
<tr class="row-even"><td>merchant-account-id / value</td>
<td>String</td>
<td>A unique identifier assigned to every merchant account (by Bankograph).</td>
</tr>
<tr class="row-odd"><td>transaction-state</td>
<td>String</td>
<td><dl class="first last docutils">
<dt>The current transaction state. Possible values:</dt><dd><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">in-progress</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">success</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">failed</span></code></li>
</ul>
<p>Typically, a transaction starts with state <code class="docutils literal notranslate"><span class="pre">in-progress</span></code> and finishes with state either <code class="docutils literal notranslate"><span class="pre">success</span></code> or <code class="docutils literal notranslate"><span class="pre">failed</span></code>. This information is returned in the response only.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td>payment-mode / name</td>
<td>String</td>
<td>The name of the payment method used for the transaction.</td>
</tr>
<tr class="row-odd"><td>cancel-redirect-url</td>
<td>String</td>
<td>The URL to which the consumer is redirected after having canceled payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/cancel">https://demoshop-test.bankograph.com/demoshop/#/cancel</a></td>
</tr>
<tr class="row-even"><td>success-redirect-url</td>
<td>String</td>
<td>The URL to which the consumer is redirected after a successful payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/success">https://demoshop-test.bankograph.com/demoshop/#/success</a></td>
</tr>
<tr class="row-odd"><td>fail-redirect-url</td>
<td>String</td>
<td>The URL to which the consumer is redirected after a unsuccessful payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/error">https://demoshop-test.bankograph.com/demoshop/#/error</a></td>
</tr>
<tr class="row-even"><td>api-id</td>
<td>String</td>
<td>Identifier of the currently used API.</td>
</tr>
<tr class="row-odd"><td>request-id</td>
<td>String</td>
<td>A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later.</td>
</tr>
<tr class="row-even"><td>requested-amount / currency</td>
<td>String</td>
<td>The currency of the requested/contested transaction amount.</td>
</tr>
<tr class="row-odd"><td>requested-amount / value</td>
<td>Numeric</td>
<td>The full amount that is requested/contested in a transaction.</td>
</tr>
<tr class="row-even"><td>status / description</td>
<td>String</td>
<td>The description of the transaction status message.</td>
</tr>
<tr class="row-odd"><td>status / severity</td>
<td>String</td>
<td><dl class="first last docutils">
<dt>The definition of the status message. Possible values:</dt><dd><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">information</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">warning</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">error</span></code></li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td>status / code</td>
<td>String</td>
<td>Status code of the status message.</td>
</tr>
<tr class="row-odd"><td>authorization-code</td>
<td>String</td>
<td>Output code for transaction type authorization.</td>
</tr>
<tr class="row-even"><td>account-holder / first-name</td>
<td>String</td>
<td>The first name of the account holder.</td>
</tr>
<tr class="row-odd"><td>account-holder / last-name</td>
<td>String</td>
<td>The last name of the account holder.</td>
</tr>
<tr class="row-even"><td>descriptor</td>
<td>String</td>
<td>Describes the transaction.</td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">For</span> <span class="n">more</span> <span class="n">information</span> <span class="n">on</span> <span class="n">redirect</span> <span class="n">URLs</span><span class="p">,</span> <span class="n">see</span> <span class="n">Configuring</span> <span class="n">Redirects</span> <span class="ow">and</span> <span class="n">IPNs</span> <span class="k">for</span> <span class="n">WPP</span> <span class="n">v2</span><span class="o">.</span>
<span class="n">For</span> <span class="n">payment</span><span class="o">-</span><span class="n">method</span><span class="o">-</span><span class="n">specific</span> <span class="n">requests</span><span class="p">,</span> <span class="n">head</span> <span class="n">over</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Payment</span> <span class="n">Methods</span> <span class="k">with</span> <span class="n">WPP</span> <span class="n">v2</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="merchants-integrated-with-nvp-hpp">
<h4>Merchants Integrated with NVP (HPP)<a class="headerlink" href="#merchants-integrated-with-nvp-hpp" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><strong>Migrating to WPP v2</strong></div></blockquote>
<p>In addition to the new backend-to-backend JSON flow, WPP v2 supports an updated NVP flow for merchants who already integrated one of the Payment Page solutions previously and do not want to switch.</p>
<p>In that case, the migration to WPP v2 requires only a few minor changes. New features have an NVP field equivalent so you can use them in your integration. Check the WPP v2 Features section for specifics.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Contact `merchant support`_ for your production credentials.
</pre></div>
</div>
<ol class="arabic simple">
<li>Find the <code class="docutils literal notranslate"><span class="pre">paymentPageLoader</span></code> JavaScript library in your <code class="docutils literal notranslate"><span class="pre">&lt;head&gt;</span></code> HTML code:</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;https://api-test.bankograph.com/engine/hpp/paymentPageLoader.js&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Replace it with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;https://wpp-test.bankograph.com/loader/paymentPage.js&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Find the <code class="docutils literal notranslate"><span class="pre">hostedPay</span></code> function call at the end of your Pay button function:</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WirecardPaymentPage</span><span class="o">.</span><span class="n">hostedPay</span><span class="p">(</span><span class="n">requestData</span><span class="p">);</span>
</pre></div>
</div>
<p>Replace it with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WPP</span><span class="o">.</span><span class="n">hostedPay</span><span class="p">(</span><span class="n">requestData</span><span class="p">);</span>
</pre></div>
</div>
<p>The fields in <code class="docutils literal notranslate"><span class="pre">requestData</span></code> remain the same and no changes are needed.</p>
</div>
</div>
<div class="section" id="epp-integration-guide">
<h3>EPP Integration Guide<a class="headerlink" href="#epp-integration-guide" title="Permalink to this headline">¶</a></h3>
<p><em>Download the full integration demo from our GitHub</em>
<strong>Download the full integration demo from our GitHub</strong></p>
<a class="reference external image-reference" href="https://github.com/wirecard/wpp-integration-demo-java"><img alt="_images/Available_on_Github_JAVA.png" src="_images/Available_on_Github_JAVA.png" /></a>
<a class="reference external image-reference" href="https://github.com/wirecard/wpp-integration-demo-php"><img alt="_images/Available_on_Github_PHP.png" src="_images/Available_on_Github_PHP.png" /></a>
<div class="section" id="id3">
<h4>Overview<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>To integrate the Embedded Payment Page (EPP) in your shop, use a simple backend-to-backend JSON workflow for the payment process.</p>
<ol class="arabic simple">
<li><strong>Create a payment session:</strong> You send an initial POST request with details of the transaction to the Bankograph Payment Page v2 (WPP v2). This POST request is secured by basic access authentication.</li>
<li><strong>Render/create the payment page:</strong> WPP v2 returns an initial response URL.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">If</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">POST</span> <span class="n">request</span> <span class="ow">is</span> <span class="n">correct</span><span class="p">,</span> <span class="n">use</span> <span class="n">the</span> <span class="n">response</span> <span class="n">URL</span> <span class="n">to</span> <span class="n">render</span> <span class="n">the</span> <span class="n">embedded</span> <span class="n">payment</span> <span class="n">page</span> <span class="k">as</span> <span class="n">an</span> <span class="n">overlay</span> <span class="n">to</span> <span class="n">the</span> <span class="n">checkout</span> <span class="n">page</span><span class="o">.</span> <span class="n">The</span> <span class="n">consumer</span> <span class="n">fills</span> <span class="n">out</span> <span class="n">the</span> <span class="n">required</span> <span class="n">fields</span> <span class="n">on</span> <span class="n">the</span> <span class="n">payment</span> <span class="n">page</span> <span class="ow">and</span> <span class="n">submits</span> <span class="n">the</span> <span class="n">payment</span><span class="o">.</span> <span class="o">**</span><span class="n">Continue</span> <span class="k">with</span> <span class="n">step</span> <span class="mi">3</span><span class="o">**.</span>

<span class="o">-</span> <span class="n">If</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">POST</span> <span class="n">request</span> <span class="ow">is</span> <span class="n">faulty</span><span class="p">,</span> <span class="n">WPP</span> <span class="n">v2</span> <span class="n">returns</span> <span class="n">an</span> <span class="n">error</span> <span class="n">code</span> <span class="k">with</span> <span class="n">a</span> <span class="n">description</span> <span class="n">of</span> <span class="n">the</span> <span class="n">problem</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">response</span><span class="o">.</span> <span class="o">**</span><span class="n">Return</span> <span class="n">to</span> <span class="n">step</span> <span class="mi">1</span><span class="o">**.</span>
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p class="first"><strong>Parse and process the payment response:</strong> The payment is processed. Depending on the result (successful, pending, failed or canceled), the consumer is redirected to the respective page. The WPP v2 sends a POST request containing base64 encoded payment data to the same URL. It is highly recommended that you parse and process this base64 encoded response to verify the payment.</p>
<p><strong>The payment process is complete.</strong></p>
</li>
</ol>
</div>
<div class="section" id="id4">
<h4>Payment-Processing Example<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>This is an example of a credit card transaction to show how to process a payment with the Embedded Payment Page.
For more supported payment methods and payment-method-specific integration guides, go to <a href="#id20"><span class="problematic" id="id21">`Payment Methods with WPP v2`_</span></a>.</p>
<p>The payment-processing example is <strong>designed for the testing environment</strong> and <strong>does not use real information</strong>.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">**</span><span class="n">Payment</span> <span class="n">processing</span> <span class="k">with</span> <span class="n">the</span> <span class="n">Bankograph</span> <span class="n">Payment</span> <span class="n">Page</span> <span class="n">v2</span> <span class="n">generally</span> <span class="n">follows</span> <span class="n">the</span> <span class="n">same</span> <span class="n">steps</span><span class="p">:</span><span class="o">**</span>

<span class="mf">1.</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">payment</span> <span class="n">session</span> <span class="p">(</span><span class="n">initial</span> <span class="n">request</span><span class="p">)</span><span class="o">.</span>

<span class="mf">2.</span> <span class="n">Render</span> <span class="n">the</span> <span class="n">embedded</span> <span class="n">payment</span> <span class="n">page</span><span class="o">.</span>

<span class="mf">3.</span> <span class="n">Highly</span> <span class="n">recommended</span><span class="p">:</span> <span class="n">Parse</span> <span class="ow">and</span> <span class="n">process</span> <span class="n">the</span> <span class="n">payment</span> <span class="n">response</span><span class="o">.</span>
</pre></div>
</div>
<p>We provide ready-made JSON samples for each step of this process. Use a tool such as <code class="docutils literal notranslate"><span class="pre">Postman</span></code> to test them.</p>
<p><strong>Setup and Test Credentials</strong></p>
<p>Before you can send your first request, use the following information to set up your testing tool:</p>
<table id="id12">
<caption><span class="caption-text">Test Credentials</span><a class="headerlink" href="#id12" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>URL (Endpoint)</strong></td>
<td><a class="reference external" href="https://wpp-test.bankograph.com/api/payment/register">https://wpp-test.bankograph.com/api/payment/register</a></td>
</tr>
<tr class="row-even"><td><strong>Merchant Account ID (MAID)</strong></td>
<td>7a6dd74f-06ab-4f3f-a864-adc52687270a</td>
</tr>
<tr class="row-odd"><td><strong>Username</strong></td>
<td>70000-APIDEMO-CARD</td>
</tr>
<tr class="row-even"><td><strong>Password</strong></td>
<td>ohysS0-dvfMx</td>
</tr>
<tr class="row-odd"><td><strong>Secret Key (used for response verification)</strong></td>
<td>a8c3fce6-8df7-4fd6-a1fd-62fa229c5e55</td>
</tr>
<tr class="row-even"><td><strong>Test Card</strong></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><strong>Card number</strong></td>
<td>4200000000000018</td>
</tr>
<tr class="row-even"><td><strong>Expiration date</strong></td>
<td>01/23</td>
</tr>
<tr class="row-odd"><td><strong>CVV</strong></td>
<td>018</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li><strong>Create a Payment Session</strong></li>
</ol>
<p>To create a payment session, send a <strong>POST request</strong> to the <code class="docutils literal notranslate"><span class="pre">/api/payment/register</span></code> endpoint, e.g. <code class="docutils literal notranslate"><span class="pre">https://wpp-test.bankograph.com/api/payment/register</span></code>.</p>
<p>This is an HTTP request with two headers:</p>
<blockquote>
<div><strong>Request Headers</strong></div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="n">Authorization</span><span class="p">:</span> <span class="n">Basic</span> <span class="n">NzAwMDAtQVBJREVNTy1DQVJEOm9oeXNTMC1kdmZNeA</span><span class="o">==</span>
</pre></div>
</div>
<p>The Authorization header needs to be formatted as: &quot;Authorization&quot;=&quot;Basic&quot; + base64(&quot;username:password&quot;)</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Code Blocks can have captions.</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span> <span class="p">{</span>
   <span class="nt">&quot;payment&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="nt">&quot;merchant-account-id&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;7a6dd74f-06ab-4f3f-a864-adc52687270a&quot;</span>
<span class="p">},</span>
<span class="nt">&quot;request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;{{$guid}}&quot;</span><span class="p">,</span>
<span class="nt">&quot;transaction-type&quot;</span><span class="p">:</span> <span class="s2">&quot;authorization&quot;</span><span class="p">,</span>
<span class="nt">&quot;requested-amount&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nt">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;EUR&quot;</span>
<span class="p">},</span>
<span class="nt">&quot;account-holder&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;first-name&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
  <span class="nt">&quot;last-name&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span>
<span class="p">},</span>
<span class="nt">&quot;payment-methods&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;payment-method&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;creditcard&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">},</span>
<span class="nt">&quot;success-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/success&quot;</span><span class="p">,</span>
<span class="nt">&quot;fail-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/error&quot;</span><span class="p">,</span>
<span class="nt">&quot;cancel-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/cancel&quot;</span>
<span class="p">},</span>
  <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;embedded&quot;</span><span class="p">,</span>
  <span class="nt">&quot;frame-ancestor&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<table id="id14">
<caption><span class="caption-text">Field Table</span><a class="headerlink" href="#id14" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-even"><td><strong>Field (JSON)</strong></td>
<td><strong>Data Type</strong></td>
<td><strong>Required/Optional</strong></td>
<td><strong>Size</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-odd"><td>merchant-account-id / value</td>
<td>String</td>
<td>Required</td>
<td>36</td>
<td>A unique identifier assigned to every merchant account (by Bankograph).</td>
</tr>
<tr class="row-even"><td>request-id</td>
<td>String</td>
<td>Required</td>
<td>150</td>
<td><dl class="first last docutils">
<dt>A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later. {{$guid}} serves as a placeholder for a random request-id. Allowed characters:</dt><dd>a - z
0 - 9</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td>transaction-type</td>
<td>String</td>
<td>Required</td>
<td>36</td>
<td>The requested transaction type.</td>
</tr>
<tr class="row-even"><td>requested-amount /Value</td>
<td>Numeric</td>
<td>Required</td>
<td>18</td>
<td>The full amount that is requested/contested in a transaction. 2 decimal places allowed. Use (decimal point) as the separator.</td>
</tr>
<tr class="row-odd"><td>requested-amount /currency</td>
<td>String</td>
<td>Required</td>
<td>3</td>
<td>The currency of the requested/contested transaction amount. Format 3-character abbreviation according to ISO 4217.</td>
</tr>
<tr class="row-even"><td>account holder / first-name</td>
<td>String</td>
<td>Optional</td>
<td>32</td>
<td>The first name of the account holder.</td>
</tr>
<tr class="row-odd"><td>account holder / last-name</td>
<td>String</td>
<td>Required</td>
<td>32</td>
<td>The last name of the account holder.</td>
</tr>
<tr class="row-even"><td>payment-method / name</td>
<td>String</td>
<td>Optional</td>
<td>15</td>
<td>The name of the payment method used. Set this value to creditcard.</td>
</tr>
<tr class="row-odd"><td>success-redirect-url</td>
<td>String</td>
<td>Optional</td>
<td>256</td>
<td>The URL to which the consumer is redirected after a successful payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/success">https://demoshop-test.bankograph.com/demoshop/#/success</a></td>
</tr>
<tr class="row-even"><td>fail-redirect-url</td>
<td>String</td>
<td>Optional</td>
<td>256</td>
<td>The URL to which the consumer is redirected after a unsuccessful payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/error">https://demoshop-test.bankograph.com/demoshop/#/error</a></td>
</tr>
<tr class="row-odd"><td>cancel-redirect-url</td>
<td>String</td>
<td>Optional</td>
<td>256</td>
<td>The URL to which the consumer is redirected after having canceled a payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/cancel">https://demoshop-test.bankograph.com/demoshop/#/cancel</a></td>
</tr>
<tr class="row-even"><td>options / mode</td>
<td>String</td>
<td>Required</td>
<td>8</td>
<td>Indicates which mode of payment page is used for the payment. Currently supports <code class="docutils literal notranslate"><span class="pre">seamless</span></code> and <code class="docutils literal notranslate"><span class="pre">embedded</span></code>.</td>
</tr>
<tr class="row-odd"><td>options / frame-ancestor</td>
<td>String</td>
<td>Required</td>
<td>256</td>
<td>The URL of the checkout page where the iframe is rendered.</td>
</tr>
</tbody>
</table>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">To create a payment session with Credit Card using 3D Secure 2 authentication, you need to include 3D Secure 2 fields in your initial request.
Most of these fields are optional but we recommend the implementation of optional fields, as this creates a smoother user experience and ensures a higher level of security.
Need more information on 3D Secure 2? Head to our general introduction to 3D Secure 2.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p><strong>Which Payment Methods Can I Choose?</strong></p>
<p>Leave out the payment-methods object from the request. WPP v2 will show a grid of all available payment methods (based on your merchant configuration).</p>
<p class="last">Alternatively, check out Payment Methods with WPP v2 for an overview of all supported payment methods.</p>
</div>
<p><strong>Download the full integration demo from our GitHub</strong></p>
<blockquote>
<div><a class="reference external image-reference" href="https://github.com/wirecard/wpp-integration-demo-java"><img alt="_images/Available_on_Github_JAVA.png" src="_images/Available_on_Github_JAVA.png" /></a>
<a class="reference external image-reference" href="https://github.com/wirecard/wpp-integration-demo-php"><img alt="_images/Available_on_Github_PHP.png" src="_images/Available_on_Github_PHP.png" /></a>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><strong>Embed the Payment Page</strong></li>
</ol>
<p>The payment page is in this case an overlay window. It is created using the <code class="docutils literal notranslate"><span class="pre">payment-redirect-url</span></code>, contained in the response to the initial authorization request.</p>
<p><strong>Response to Authorization Request</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s2">&quot;payment-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://wpp-test.bankograph.com/?wPaymentToken=f0c0e5b3-23ad-4cb4-abca-ed80a0e770e7&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Embedding the Payment Page in your Checkout Page Using</strong> <code class="docutils literal notranslate"><span class="pre">WPP.embeddedPayUrl</span></code></p>
<p>You can use our predefined function to embed the payment page:</p>
<ol class="arabic simple">
<li>Add the <code class="docutils literal notranslate"><span class="pre">paymentPage.js</span></code> library to your checkout page HTML code</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;script src=&quot;https://wpp-test.bankograph.com/loader/paymentPage.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;

Make sure to pass the ``payment-redirect-url`` value from the initial response to the ``WPP.embeddedPayUrl`` function and call it to render the payment page.
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Submit the <strong>initial payment request</strong> on the backend.</li>
<li>Call the <code class="docutils literal notranslate"><span class="pre">WPP.hostedPayUrl(payment-redirect-url)</span></code> function in your HTML code to render the new pop-up window.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span><span class="n">WPP</span><span class="o">.</span><span class="n">embeddedPayUrl</span><span class="p">(</span><span class="s2">&quot;https://wpp-test.bankograph.com/?wPaymentToken=f0c0e5b3-23ad-4cb4-abca-ed80a0e770e7&quot;</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p>The consumer is redirected to the payment form. There they enter their data and submit the form to confirm the payment. The response can</p>
<ul class="simple">
<li>be successful (<code class="docutils literal notranslate"><span class="pre">transaction-state:</span> <span class="pre">success</span></code>)</li>
<li>fail (<code class="docutils literal notranslate"><span class="pre">transaction-state:</span> <span class="pre">failed</span></code>)</li>
<li>or the consumer canceled the payment before/after submission (<code class="docutils literal notranslate"><span class="pre">transaction-state:</span> <span class="pre">failed</span></code>).</li>
</ul>
<p>The transaction result is displayed as the value of <code class="docutils literal notranslate"><span class="pre">transaction-state</span></code> in the payment response. Canceled payments are returned as <code class="docutils literal notranslate"><span class="pre">&quot;transaction-state&quot;</span> <span class="pre">:</span> <span class="pre">&quot;failed&quot;</span></code>, but the status description indicates it was canceled. More information (including the status code) can also be found in the payment response in the statuses object.</p>
<p>In any case, a base64 encoded response containing payment information is sent to the corresponding redirection URL <code class="docutils literal notranslate"><span class="pre">(success-redirect-url,</span> <span class="pre">cancel-redirect-url,</span> <span class="pre">or</span> <span class="pre">fail-redirect-url)</span></code>.</p>
<p class="last">See <a href="#id22"><span class="problematic" id="id23">`Configuring Redirects and IPNs for WPP v2`_</span></a> for more information on redirection targets after payment.</p>
</div>
<ol class="arabic simple" start="3">
<li><strong>Parse and Process the Payment Response (Highly Recommended)</strong></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Where</span> <span class="pre">Can</span> <span class="pre">I</span> <span class="pre">Find</span> <span class="pre">the</span> <span class="pre">Payment</span> <span class="pre">Response?</span></code></p>
<blockquote>
<div><p>WPP v2 sends the final response to the success/fail page where the consumer is redirected to at the end of the payment session. This final response contains the payment data in a base64 encoded JSON format. It is sent with a POST request as form data <code class="docutils literal notranslate"><span class="pre">response-base64</span></code>.</p>
<blockquote>
<div><img alt="_images/Base64_v2_1.png" src="_images/Base64_v2_1.png" />
</div></blockquote>
</div></blockquote>
</div></blockquote>
<p>Before you are able to parse and process the payment response, you need to decode it.</p>
<p><strong>To test this</strong></p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li>Copy and paste the <code class="docutils literal notranslate"><span class="pre">payment-redirect-url</span></code> into your browser.</li>
<li>Open your browser’s console and complete the payment with the credit card information provided above.</li>
<li>In your browser’s console, find the form data <code class="docutils literal notranslate"><span class="pre">response-base64</span></code> (see screenshot).</li>
<li>Copy and paste the response into a base64 decoder of your choice, e.g. <a href="#id5"><span class="problematic" id="id6">:PEP:`Base64 Decode`</span></a>.</li>
<li>Decode the response to view the payment response details.</li>
</ul>
</div></blockquote>
<p>You can find a decoded payment response example below.</p>
</div></blockquote>
<p><strong>Parse and Process the Payment Response (Decoded Payment Response)</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s2">&quot;payment&quot;</span><span class="p">:</span> <span class="p">{</span>
   <span class="s2">&quot;transaction-type&quot;</span><span class="p">:</span> <span class="s2">&quot;authorization&quot;</span><span class="p">,</span>
   <span class="s2">&quot;transaction-id&quot;</span><span class="p">:</span> <span class="s2">&quot;08649015-eb17-4c67-ab5f-d132af616e02&quot;</span><span class="p">,</span>
   <span class="s2">&quot;completion-time-stamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-12-19T12:02:26&quot;</span><span class="p">,</span>
   <span class="s2">&quot;card-token&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">&quot;token-id&quot;</span><span class="p">:</span> <span class="s2">&quot;4242796444090018&quot;</span><span class="p">,</span>
     <span class="s2">&quot;masked-account-number&quot;</span><span class="p">:</span> <span class="s2">&quot;420000******0018&quot;</span>
   <span class="p">},</span>
   <span class="s2">&quot;merchant-account-id&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;7a6dd74f-06ab-4f3f-a864-adc52687270a&quot;</span>
   <span class="p">},</span>
   <span class="s2">&quot;transaction-state&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
   <span class="s2">&quot;payment-methods&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">&quot;payment-method&quot;</span><span class="p">:</span> <span class="p">[</span>
       <span class="p">{</span>
         <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;creditcard&quot;</span>
       <span class="p">}</span>
     <span class="p">]</span>
    <span class="p">},</span>
   <span class="s2">&quot;cancel-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/cancel&quot;</span><span class="p">,</span>
   <span class="s2">&quot;success-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/success&quot;</span><span class="p">,</span>
   <span class="s2">&quot;fail-redirect-url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://demoshop-test.bankograph.com/demoshop/#/error&quot;</span><span class="p">,</span>
   <span class="s2">&quot;api-id&quot;</span><span class="p">:</span> <span class="s2">&quot;wpp&quot;</span>
  <span class="p">},</span>
 <span class="s2">&quot;request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;28285dbd-ecd3-49bd-a7e5-0239affa2448&quot;</span><span class="p">,</span>
 <span class="s2">&quot;requested-amount&quot;</span><span class="p">:</span> <span class="p">{</span>
   <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
   <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">10</span>
  <span class="p">},</span>
 <span class="s2">&quot;statuses&quot;</span><span class="p">:</span> <span class="p">{</span>
   <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="p">[</span>
     <span class="p">{</span>
       <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;3d-acquirer:The resource was successfully created.&quot;</span><span class="p">,</span>
       <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;information&quot;</span><span class="p">,</span>
       <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;201.0000&quot;</span>
     <span class="p">}</span>
   <span class="p">]</span>
  <span class="p">},</span>
 <span class="s2">&quot;authorization-code&quot;</span><span class="p">:</span> <span class="s2">&quot;801433&quot;</span><span class="p">,</span>
 <span class="s2">&quot;account-holder&quot;</span><span class="p">:</span> <span class="p">{</span>
   <span class="s2">&quot;first-name&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
   <span class="s2">&quot;last-name&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span>
  <span class="p">},</span>
 <span class="s2">&quot;descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;demo descriptor&quot;</span>
 <span class="p">}</span>
</pre></div>
</div>
<table id="id15">
<caption><span class="caption-text">Field Table</span><a class="headerlink" href="#id15" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr class="row-even"><td><strong>Field (JSON)</strong></td>
<td><strong>Data Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-odd"><td>transaction-type</td>
<td>String</td>
<td>The requested transaction type.</td>
</tr>
<tr class="row-even"><td>transaction-id</td>
<td>String</td>
<td>A unique identifier to every transaction (by Bankograph). Used when searching for or referencing to it later.</td>
</tr>
<tr class="row-odd"><td>completion-time-stamp</td>
<td>YYYY-MM-DD-Thh:mm:ss</td>
<td>The UTC/ISO time-stamp documents the time &amp; date when the transaction was executed. Format: YYYY-MM-DDThh:mm:ss (ISO).</td>
</tr>
<tr class="row-even"><td>card token / token-id</td>
<td>String</td>
<td>A unique identifier assigned to every card token.</td>
</tr>
<tr class="row-odd"><td>card token / masked-account-number</td>
<td>String</td>
<td>This is the masked card account number of the consumer.</td>
</tr>
<tr class="row-even"><td>merchant-account-id / value</td>
<td>String</td>
<td>A unique identifier assigned to every merchant account (by Bankograph).</td>
</tr>
<tr class="row-odd"><td>transaction-state</td>
<td>String</td>
<td><dl class="first last docutils">
<dt>The current transaction state. Possible values:</dt><dd><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">in-progress</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">success</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">failed</span></code></li>
</ul>
<p>Typically, a transaction starts with state <code class="docutils literal notranslate"><span class="pre">in-progress</span></code> and finishes with state either <code class="docutils literal notranslate"><span class="pre">success</span></code> or <code class="docutils literal notranslate"><span class="pre">failed</span></code>. This information is returned in the response only.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td>payment-mode / name</td>
<td>String</td>
<td>The name of the payment method used for the transaction.</td>
</tr>
<tr class="row-odd"><td>cancel-redirect-url</td>
<td>String</td>
<td>The URL to which the consumer is redirected after having canceled payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/cancel">https://demoshop-test.bankograph.com/demoshop/#/cancel</a></td>
</tr>
<tr class="row-even"><td>success-redirect-url</td>
<td>String</td>
<td>The URL to which the consumer is redirected after a successful payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/success">https://demoshop-test.bankograph.com/demoshop/#/success</a></td>
</tr>
<tr class="row-odd"><td>fail-redirect-url</td>
<td>String</td>
<td>The URL to which the consumer is redirected after a unsuccessful payment, e.g. <a class="reference external" href="https://demoshop-test.bankograph.com/demoshop/#/error">https://demoshop-test.bankograph.com/demoshop/#/error</a></td>
</tr>
<tr class="row-even"><td>api-id</td>
<td>String</td>
<td>Identifier of the currently used API.</td>
</tr>
<tr class="row-odd"><td>request-id</td>
<td>String</td>
<td>A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later.</td>
</tr>
<tr class="row-even"><td>requested-amount / currency</td>
<td>String</td>
<td>The currency of the requested/contested transaction amount.</td>
</tr>
<tr class="row-odd"><td>requested-amount / value</td>
<td>Numeric</td>
<td>The full amount that is requested/contested in a transaction.</td>
</tr>
<tr class="row-even"><td>status / description</td>
<td>String</td>
<td>The description of the transaction status message.</td>
</tr>
<tr class="row-odd"><td>status / severity</td>
<td>String</td>
<td><dl class="first last docutils">
<dt>The definition of the status message. Possible values:</dt><dd><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">information</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">warning</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">error</span></code></li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td>status / code</td>
<td>String</td>
<td>Status code of the status message.</td>
</tr>
<tr class="row-odd"><td>authorization-code</td>
<td>String</td>
<td>Output code for transaction type authorization.</td>
</tr>
<tr class="row-even"><td>account-holder / first-name</td>
<td>String</td>
<td>The first name of the account holder.</td>
</tr>
<tr class="row-odd"><td>account-holder / last-name</td>
<td>String</td>
<td>The last name of the account holder.</td>
</tr>
<tr class="row-even"><td>descriptor</td>
<td>String</td>
<td>Describes the transaction.</td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">For</span> <span class="n">more</span> <span class="n">information</span> <span class="n">on</span> <span class="n">redirect</span> <span class="n">URLs</span><span class="p">,</span> <span class="n">see</span> <span class="n">Configuring</span> <span class="n">Redirects</span> <span class="ow">and</span> <span class="n">IPNs</span> <span class="k">for</span> <span class="n">WPP</span> <span class="n">v2</span><span class="o">.</span>
<span class="n">For</span> <span class="n">payment</span><span class="o">-</span><span class="n">method</span><span class="o">-</span><span class="n">specific</span> <span class="n">requests</span><span class="p">,</span> <span class="n">head</span> <span class="n">over</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Payment</span> <span class="n">Methods</span> <span class="k">with</span> <span class="n">WPP</span> <span class="n">v2</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="merchants-integrated-with-nvp-epp">
<h4>Merchants Integrated with NVP (EPP)<a class="headerlink" href="#merchants-integrated-with-nvp-epp" title="Permalink to this headline">¶</a></h4>
<p><strong>Migrating to WPP v2</strong></p>
<p>In addition to the new backend-to-backend JSON flow, WPP v2 supports an updated NVP flow for merchants who already integrated one of the Payment Page solutions previously and do not want to switch.</p>
<p>In that case, the migration to WPP v2 requires only a few minor changes. New features have an NVP field equivalent so you can use them in your integration. Check the WPP v2 Features section for specifics.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Contact</span> <span class="n">merchant</span> <span class="n">support</span> <span class="k">for</span> <span class="n">your</span> <span class="n">production</span> <span class="n">credentials</span><span class="o">.</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>Find the paymentPageLoader JavaScript library in your &lt;head&gt; HTML code:</li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;https://api-test.bankograph.com/engine/hpp/paymentPageLoader.js&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Replace it with:</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;https://wpp-test.bankograph.com/loader/paymentPage.js&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Find the embeddedPay function call at the end of your Pay button function:</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WirecardPaymentPage</span><span class="o">.</span><span class="n">embeddedPay</span><span class="p">(</span><span class="n">requestData</span><span class="p">);</span>
</pre></div>
</div>
<p>Replace it with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WPP</span><span class="o">.</span><span class="n">embeddedPay</span><span class="p">(</span><span class="n">requestData</span><span class="p">);</span>
</pre></div>
</div>
<p>The fields in requestData remain the same and no changes are needed.</p>
</div>
</div>
<div class="section" id="seamless-integration-guide">
<h3>Seamless Integration Guide<a class="headerlink" href="#seamless-integration-guide" title="Permalink to this headline">¶</a></h3>
<p><em>Download the full integration demo from our Github</em></p>
<a class="reference external image-reference" href="https://github.com/wirecard/wpp-integration-demo-java"><img alt="_images/Available_on_Github_JAVA.png" src="_images/Available_on_Github_JAVA.png" /></a>
<a class="reference external image-reference" href="https://github.com/wirecard/wpp-integration-demo-php"><img alt="_images/Available_on_Github_PHP.png" src="_images/Available_on_Github_PHP.png" /></a>
<div class="section" id="id7">
<h4>Overview<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>To integrate the Bankograph Payment Page v2 in Seamless Mode in your shop, get your checkout page ready in two steps:</p>
<ol class="arabic simple">
<li><strong>Preparing your checkout page</strong>: Add the <code class="docutils literal notranslate"><span class="pre">paymentPage.js</span></code> library to your checkout page’s HTML code.</li>
<li><strong>Changing the background color setting in Payment Page Designer:</strong> Set the background color to transparent in Payment Page Designer.</li>
</ol>
<p>Then use a backend-to-backend JSON workflow for the payment process.</p>
<ol class="arabic simple">
<li><strong>Create a payment session:</strong> You send an initial POST request with details of the transaction to the Bankograph Payment Page v2 (WPP v2). This POST request is secured by basic access authentication.</li>
<li><strong>Render the seamless payment form:</strong> WPP v2 returns an initial response URL.</li>
</ol>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<ul class="last simple">
<li>If the initial POST request is correct, use this response URL and the WPP.seamlessRender library call to render the payment form in a seamless iframe. Continue with step 3.</li>
<li>If the initial POST request is faulty, WPP v2 returns an error code with a description of the problem in the response. Return to step 1.</li>
</ul>
</div>
<ol class="arabic simple" start="3">
<li><strong>Submit the payment:</strong> The consumer fills in the payment form. Use the WPP.seamlessSubmit function to submit the payment. Ensure that the function is bound to an interactive UI element, such as a button, in your HTML code.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><strong>3D Secure credit card payment</strong> automatically redirects the consumer to the authentication page, and then to a WPP v2 success- or fail-redirect-url. Include the success- and fail-redirect-urls in your initial request! This page includes a JSON sample for 3D Secure credit card payment.</li>
<li><strong>Non-3D Secure credit card payment</strong> requires you to implement redirects to subsequent pages, such as a <code class="docutils literal notranslate"><span class="pre">success-/fail-/cancel-redirect-url</span></code> to let the consumer know about the payment outcome, by yourself.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><strong>Parse and Process the Payment Response:</strong> The payment is processed. WPP v2 returns base64 encoded payment data. It is highly recommended that you parse and process this base64 encoded response to verify the payment.</li>
</ol>
</div>
<div class="section" id="first-steps">
<h4>First Steps<a class="headerlink" href="#first-steps" title="Permalink to this headline">¶</a></h4>
<p>Before processing payments in Seamless Mode, you need to make a small adjustment to your checkout page’s HTML code, and change a setting in the Payment Page Designer.</p>
<p>1. Preparing your Checkout Page
Add the paymentPage.js library to your checkout page HTML code:</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer-row" class="row">

    <div class="col-md-12">
        <span></span><span class="pull-right">&copy; Copyright .
        Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.2 and the
        <a href="https://pypi.org/project/sphinx-sizzle-theme/"

           title="0.0.9/821a5457 [2020-04-16T19:31:16]"

        >Sizzle</a> theme.</span>
    </div>

  </div>
</div>

<div id="tooltips" class="hidden">
</div>

<script>
$(document).ready(function() {
  'use strict';
  var $search = $('.search-query');

  var $filter = $('#toc-filter-query');
  var $toclist = $('.sidebar-toc > ul').find('li');

  if ($toclist.length === 0) {
    $toclist = $('.localtoc > ul').find('li');
  }


  var $nav = $('#nav');

  //$('#whole-page').removeClass('hidden');
  var nav_width = $nav.width();


  var search_url = 'search.html';

  function perform_search(e) {
    var $elem;

    if (e.type === 'keypress') {
      $elem = $(e.target);
    }
    else if (e.type === 'click') {
      $elem = $(e.target).parents('.input-group').find('input');
    }
    var q = $elem.val().trim();

    if (q) {
      var url = search_url + '?q=' + q + '&check_keywords=yes&area=default';

      location.href = url;
    }
  }


  function apply_filter() {
    var s = $filter.val().trim().toLowerCase();

    $toclist.find('a').removeClass('hidden');
    $toclist.each(function() {
      var $this = $(this);
      var $link = $this.find('> a');
      var t = $link.text().toLowerCase();
      var show = t.indexOf(s) >= 0;

      if (!show) {
        $link.addClass('hidden');
      }
    });
  }

  $filter.on('keyup', function(e) {
    apply_filter();
  });



  $search.on('keypress', function(e) {
    if (e.which == 13) {
      perform_search(e);
    }
  });
  $search.parents('.input-group').find('.input-group-addon').on('click', perform_search);
  $(document).on('click', '.summary .fa-caret-right', function(e) {
    var $elem = $(e.target).parents('li');
    var $next = $elem.next();
    $elem.addClass('hidden');
    $next.removeClass('hidden');
  });
  $(document).on('click', '.detail .fa-caret-down', function(e) {
    var $elem = $(e.target).parents('li');
    var $prev = $elem.prev();
    $elem.addClass('hidden');
    $prev.removeClass('hidden');
  });

  $('#content').on('click', function() {
    $('#mnav').hide();
  });

  var counter = 0;
  var timer = null;

  function show_nav() {
    $('#content').off('mousemove', track_mouse);
    if (timer !== null) {
      clearTimeout(timer);
      timer = null;
    }
    $nav.show();
  }

  function track_mouse(e) {
    var x = e.clientX;

    if (x < 15) {
      ++counter;
      if (timer === null) {
        timer = setTimeout(show_nav, 2000);
      }
    }
    else {
      counter = 0;
    }
    if (counter >= 20) {
      show_nav();
    }
  };

  function hide_nav() {
    $nav.hide();
    counter = 0;
    $('#content').on('mousemove', track_mouse);
  }

  $('.hidetoc').on('click', hide_nav);

  $(document).on('keyup', function(e) {
    if (e.ctrlKey) {
      if (e.which == 37) {      // Ctrl+left arrow
        hide_nav();
      }
      else if (e.which == 39) { // Ctrl+right arrow
        show_nav();
      }
    }
  });

  $('.menu-toggle').on('click', function(e) {
    $('#mnav').toggle();
  });

  function scroll_nav(frag) {
    var sel = '#nav ' + (frag ? 'a[href="' + frag + '"]' : '.toctree-l1 a.current');

    var $link = $(sel);

    if ($link.length > 0) {
      $link[0].scrollIntoView({block: 'center'});
    }
  }

  // If the navigator is long, then the item we clicked on to get here might
  // not be in view. Try to scroll it into the view - a slight delay is needed
  // to get it to sync properly with other stuff going on (as the page has just
  // loaded). Hence the setTimeout with a timeout of 0.

  function do_scroll() {
    scroll_nav(window.location.hash);
  }

  setTimeout(do_scroll, 0);

  function adjust_size() {
    // we need to set the height explicitly so that scrolling regions in the
    // content area work properly.
    var h = $('#page-content').height();

    $('#nav, #content').height(h);
    if ($('#nav').is(':visible')) {
      $('#mnav').hide();
    }
  }

  adjust_size();

  $(window).on('resize', adjust_size);

  function focus_content() {
    $('#content').focus();  // so that keyboard can be used to scroll, etc.
  }

  setTimeout(focus_content, 150);

  var sizzle = $(document).data('sizzle');

  function make_tooltip(id, h, b) {
    var $e = $('<div>').attr('id', id);
    var $b = $('<div>').addClass('tc-body').html(b);

    if (h) {
      var $h = $('<div>').addClass('tc-heading').html(h);
      $e.append($h);
    }
    $e.append($b);
    return $e;
  }

  var default_tt_options = {
    theme: ['tooltipster-light', 'tooltipster-light-customized'],
    interactive: true,
    maxWidth: 600,
    contentCloning: true
  };

  function activate_tooltips() {
    var $tt = $('.tt');

    //console.log('tt links:', $tt.length);
    $tt.tooltipster(default_tt_options);
  }



  function add_glossary_tooltips() {
    var links = $('a');  // can qualify with .reference.internal
    var glinks = {};
    var pat = /(.*)\.html#(term-.*)$/;
    var found = false;  // links in this document

    $.each(links, function(i, link) {
        var $link = $(link);
        var href = $link.attr('href');
        var m = href.match(pat);

        if (m) {
          var s = m[1].replace(/^(\.\.\/)+/, '');

          if (s === sizzle.app_data.glossary.document) {
            var k = m[2];

            if (k in glinks) {
              glinks[k].push($link);
            }
            else {
              glinks[k] = [$link];
            }
            found = true;
          }
        }
    });
    if (found) {
      var $t = $('#tooltips');
      var data = sizzle.app_data.glossary.terms;

      $.each(glinks, function(k, v) {
        var d = data[k];

        if (d) {  // as a sanity check
          var s = 'tc-'+ k;
          var $e = make_tooltip(s, d.term, d.defn);
          $t.append($e);

          $.each(v, function(i, link) {
            link.addClass('tt').attr('data-tooltip-content', '#' + s);
          });
        }
      });
    }
  }

  if (sizzle.app_data && sizzle.app_data.glossary &&
      sizzle.app_data.glossary.document) {
    add_glossary_tooltips();
  }




  function add_custom_tooltips() {
    var info_tips = sizzle.app_data.custom_data['info-tips'] || {};

    if ($.isEmptyObject(info_tips)) {
      return;
    }

    var tt_options = $.extend({contentAsHTML: true}, default_tt_options);

    $('.tc-info').each(function() {
      var $elem = $(this).prev();
      var classes = $elem.attr('class');
      var m = /\btci-([\S]+)/.exec(classes);

      if (m !== null) {
        var key = m[1];

        if (key in info_tips) {
          var v = info_tips[key];
          var tt = $elem.tooltipster(tt_options).tooltipster('content', v);
        }
      }
    });
  }

  add_custom_tooltips();

  setTimeout(activate_tooltips, 1000);


  // Clipboard copy for code blocks with captions

  $('.code-block-caption').each(function() {
    var $cap = $(this);
    var $btn = $('<span class="clip-copy"><span class="copied hidden">Copied!</span><i class="fa fa-clipboard" title="Copy contents"></i></span>');
    var $code = $cap.parent().find('.highlight');

    $cap.append($btn);
    $btn.find('.fa-clipboard').data('clip-text', $code.text());
  });

  var clipboard = new ClipboardJS('.code-block-caption .fa-clipboard', {
    'text': function(trigger) {
      return $(trigger).data('clip-text');
    }
  });

  clipboard.on('success', function(e) {
    var $copied = $(e.trigger).prev();

    $copied.removeClass('hidden');

    setTimeout(function() {$copied.addClass('hidden'); }, 1000);
  });

  if (sizzle.on_load) {
    sizzle.on_load.forEach(function(f) {
      f();
    });
  }
});
</script>
</body>
</html>